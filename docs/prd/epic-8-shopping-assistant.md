# Epic 8: ðŸ›ï¸ Shopping Assistant ("Check Before You Buy")

**Goal:** Enable users to analyze potential clothing purchases (via screenshot or URL) to determine compatibility with their existing wardrobe before buying.

---

## Story 8.1: Screenshot Product Analysis

> **As a** shopper browsing Instagram or shopping apps,  
> **I want** to screenshot a product and see if it matches my wardrobe,  
> **so that** I can avoid buying items that won't work with what I own.

### Acceptance Criteria

1. "Check Before You Buy" button prominently displayed on Home screen
2. User can upload screenshot from gallery or take new photo
3. App detects product in image (clothing item, not background)
4. Loading indicator shows "Analyzing..." (3-5 seconds)
5. If multiple items detected, user selects which to analyze
6. Error handling: low quality images show warning
7. Successful analysis displays compatibility results screen

---

## Story 8.2: URL Product Scraping

> **As a** shopper on Zara/H&M/ASOS website,  
> **I want** to paste the product URL directly,  
> **so that** I can get precise product details analyzed.

### Acceptance Criteria

1. "Paste URL" input field on Shopping Assistant screen
2. Supports major fashion sites: Zara, H&M, ASOS, Mango, Uniqlo, Everlane
3. Scrapes: product image, name, brand, color, price (if available)
4. Uses Open Graph meta tags and schema.org markup
5. Fallback to screenshot method if scraping fails
6. Invalid URL shows helpful error: "We couldn't load this page. Try screenshot instead."
7. Loading indicator during scraping (5-8 seconds)

---

## Story 8.3: AI Product Extraction

> **As a** system,  
> **I want** to extract structured product data from images/URLs,  
> **so that** compatibility analysis can be performed accurately.

### Acceptance Criteria

1. Gemini 1.5 Pro analyzes image to extract product details
2. Structured data returned: name, category, color, secondary_colors, style, material, pattern, season, formality (1-10)
3. Product data stored in `shopping_scans` table
4. If extraction fails, user can manually input details
5. Extracted data shown to user for confirmation/editing
6. Edge Function handles API call to Gemini (keeps API key server-side)

---

## Story 8.4: Compatibility Score Calculation

> **As a** user analyzing a product,  
> **I want** to see a compatibility score with my wardrobe,  
> **so that** I can quickly judge if this is a good purchase.

### Acceptance Criteria

1. Score calculated 0-100 based on algorithm (color harmony 30%, style consistency 25%, gap filling 20%, versatility 15%, formality 10%)
2. Score displayed prominently with rating: "Perfect Match ðŸŽ¯" (90-100), "Great Choice âœ¨" (75-89), "Good Fit ðŸ‘" (60-74), "Might Work âš ï¸" (40-59), "Careful â—" (0-39)
3. Progress bar visualization of score
4. Score color-coded (green, yellow, orange, red)
5. Score explanation: "Based on your warm-toned wardrobe"
6. Recalculates if user makes changes to product details

---

## Story 8.5: Matching Items Display

> **As a** user reviewing compatibility,  
> **I want** to see which items in my wardrobe match the product,  
> **so that** I can visualize complete outfits.

### Acceptance Criteria

1. Top 5 matching items displayed as image thumbnails
2. Each item shows: image, name, match reason ("Classic pairing", "Color harmony")
3. Tap item to view full details
4. "See All Matches" expands to show 10+ items
5. Items grouped by category (tops, bottoms, shoes)
6. If no matches found: "You don't have complementary items. Consider adding X to your wardrobe."
7. Visual outfit preview: new item + matching items displayed together

---

## Story 8.6: AI-Generated Insights

> **As a** user deciding on a purchase,  
> **I want** to receive personalized insights about the product,  
> **so that** I can make an informed decision.

### Acceptance Criteria

1. 3 insights generated by Gemini based on wardrobe analysis
2. Insight categories: Style feedback, Wardrobe gap, Value proposition
3. Example insights:
   - "This green dress complements your warm-toned wardrobe beautifully"
   - "You don't have shoes that match this dress. Consider black heels."
   - "High versatility = great cost-per-wear potential"
   - "This overlaps with your blue blazer. Do you need both?"
4. Insights displayed below compatibility score
5. Honest, helpful tone (not always positive)
6. Length: 2-3 sentences per insight

---

## Story 8.7: Shopping Wishlist

> **As a** user who analyzed a product,  
> **I want** to save it to a wishlist,  
> **so that** I can compare options and decide later.

### Acceptance Criteria

1. "Save to Wishlist" button on compatibility results screen
2. Item saved with: product image, name, URL, compatibility score, matching items, insights
3. "Shopping Wishlist" accessible from Profile or Shopping Assistant screen
4. Wishlist displays items in grid with compatibility scores
5. Sort by: score, date added, price
6. Filter by: category, brand
7. Delete items from wishlist
8. "Re-analyze" button updates compatibility as wardrobe changes

---

## Story 8.8: Scan History & Analytics

> **As a** user who scans products regularly,  
> **I want** to view my scan history,  
> **so that** I can track my shopping research.

### Acceptance Criteria

1. "Scan History" screen shows all past scans
2. Each scan shows: product image, name, compatibility score, date
3. Tap scan to view full analysis again
4. Filter by: date, score range, scanned vs wishlist
5. Statistics: "You scanned 12 items this month, added 3 to wardrobe"
6. "Scan again" re-analyzes with updated wardrobe
7. User rating prompt: "Was this scan helpful?" (1-5 stars) for metrics
