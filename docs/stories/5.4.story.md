# Story 5.4: Neglected Items Detection

## Status

**Implemented**

---

## Story

**As a** user,  
**I want** to see which items I haven't worn recently,  
**so that** I can rediscover forgotten clothes or consider selling them.

---

## Acceptance Criteria

1. "Neglected" filter in wardrobe gallery
2. Neglected = not worn in 60+ days (configurable)
3. Neglected items highlighted with badge/icon
4. Analytics dashboard shows count of neglected items
5. Suggestion: "5 items haven't been worn in 2 months"
6. Quick action: "Suggest outfit with this item"
7. Quick action: "Create resale listing" (links to Epic 7)

---

## Tasks / Subtasks

- [x] **Task 1: Define Neglected Items Logic** (AC: 2)
  - [x] Created `utils/neglectedItems.ts` utility
  - [x] Implemented `isNeglected(item, thresholdDays)` function
  - [x] Default threshold: 60 days
  - [x] Items never worn treated as neglected if added 60+ days ago

- [x] **Task 2: Add Neglected Filter to Wardrobe** (AC: 1)
  - [x] Added "Neglected (N)" chip to wardrobe with count badge
  - [x] Filters items where last_worn_at is null or > 60 days ago
  - [x] Included in active filter count and clear-all

- [x] **Task 3: Display Neglected Badge on Items** (AC: 3)
  - [x] Added amber moon icon badge (top-left) on neglected item cards
  - [x] Subtle dark overlay on neglected cards to visually mute them
  - [x] Neglected label shown in item detail card

- [x] **Task 4: Create Neglected Items Summary** (AC: 4, 5)
  - [x] Added amber "Forgotten Items" card on Home screen
  - [x] Displays: "N items haven't been worn in 2+ months"
  - [x] Only shown when neglected count > 0
  - [x] Tap navigates to wardrobe (user can tap neglected filter there)

- [x] **Task 5: Add "Suggest Outfit" Quick Action** (AC: 6)
  - [x] Added "Suggest Outfit" button on item detail for neglected items
  - [x] Navigates to outfit builder with requiredItem param

- [x] **Task 6: Add "Create Resale Listing" Placeholder** (AC: 7)
  - [x] Added grayed-out "Resell" button next to suggest outfit
  - [x] Shows "Coming Soon" alert on tap
  - [x] Ready for Epic 7 integration

- [ ] **Task 7: Testing**
  - [ ] Test neglected detection logic
  - [ ] Test filter functionality
  - [ ] Test summary count accuracy
  - [ ] Test quick actions navigation

---

## Dev Notes

### Previous Story Dependencies
- Story 5.1: `last_worn_at` field auto-updated by wear_logs triggers âœ…
- Story 5.3: CPW display on item cards âœ…

### Neglected Detection Logic

```typescript
const NEGLECTED_THRESHOLD_DAYS = 60;

function isNeglected(item: WardrobeItem): boolean {
    if (!item.last_worn_at) {
        // Never worn â€” check if added more than threshold days ago
        const addedDate = new Date(item.created_at);
        const daysSinceAdded = Math.floor((Date.now() - addedDate.getTime()) / (1000 * 60 * 60 * 24));
        return daysSinceAdded >= NEGLECTED_THRESHOLD_DAYS;
    }
    
    const lastWorn = new Date(item.last_worn_at);
    const daysSinceWorn = Math.floor((Date.now() - lastWorn.getTime()) / (1000 * 60 * 60 * 24));
    return daysSinceWorn >= NEGLECTED_THRESHOLD_DAYS;
}

function getDaysSinceWorn(item: WardrobeItem): number | null {
    if (!item.last_worn_at) return null;
    const lastWorn = new Date(item.last_worn_at);
    return Math.floor((Date.now() - lastWorn.getTime()) / (1000 * 60 * 60 * 24));
}
```

### UI Components

**Neglected Badge (on item card):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ’¤              â”‚ â† Neglected icon (top-left)
â”‚   [item image]  â”‚
â”‚                 â”‚
â”‚     Â£4/wear ðŸŸ¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Neglected Summary Card:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ’¤ Forgotten Items                  â”‚
â”‚ 5 items haven't been worn in 2+    â”‚
â”‚ months. Rediscover them!            â”‚
â”‚                        [View â†’]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Color Palette

| Element | Color | Hex |
|---------|-------|-----|
| Neglected badge | Muted gray | `#9ca3af` |
| Warning tint | Amber | `#f59e0b` |
| Card background | Cream | `#F5F0E8` |

### File Locations

| File | Path |
|------|------|
| Neglected Utility | `apps/mobile/utils/neglectedItems.ts` |
| Wardrobe Gallery | `apps/mobile/app/(tabs)/wardrobe.tsx` |
| Item Detail | `apps/mobile/app/(tabs)/item-detail.tsx` |
| Home Screen | `apps/mobile/app/(tabs)/index.tsx` |

### Quick Action: Suggest Outfit

When user taps "Suggest outfit with this item":
1. Navigate to `/(tabs)/outfits/builder?requiredItem={itemId}`
2. Or: call Gemini with constraint `"Must include item: {itemName}"`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-06 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
No issues â€” clean TypeScript compile.

### Completion Notes List
- Created standalone `neglectedItems.ts` utility with configurable threshold (default 60 days)
- Items never worn are treated as neglected if added more than threshold days ago
- Wardrobe gallery: amber moon badge (top-left) with subtle overlay on neglected cards
- Wardrobe gallery: "Neglected (N)" filter chip with count, only shown when count > 0
- Home screen: amber "Forgotten Items" summary card with count, navigates to wardrobe
- Item detail: neglected action card with label, "Suggest Outfit" (navigates to builder with requiredItem param), and grayed-out "Resell" placeholder
- No DB migration needed â€” uses existing `last_worn_at` and `created_at` fields

### File List

| File | Action | Description |
|------|--------|-------------|
| `apps/mobile/utils/neglectedItems.ts` | Created | isNeglected, getDaysSinceWorn, formatNeglectedLabel, countNeglected, getNeglectedItems |
| `apps/mobile/app/(tabs)/wardrobe.tsx` | Modified | Added neglected filter chip, neglected badge on cards, neglected overlay |
| `apps/mobile/app/(tabs)/index.tsx` | Modified | Added neglected summary card with count and navigation |
| `apps/mobile/app/(tabs)/item-detail.tsx` | Modified | Added neglected actions card with Suggest Outfit + Resell placeholder |

---

## QA Results
_(To be completed by QA Agent)_
