# Story 5.6: Wardrobe Analytics Dashboard

## Status

**Implemented**

---

## Story

**As a** user,  
**I want** a dashboard summarizing my wardrobe insights,  
**so that** I can see usage patterns at a glance.

---

## Acceptance Criteria

1. Dashboard accessible from Profile tab
2. Summary cards: Total items, Total value, Avg CPW
3. Chart: Wardrobe distribution by category (pie/donut)
4. Chart: Wear frequency over time (last 30 days)
5. Insights section: AI-generated tips based on data
6. "Neglected items" count with link to filter
7. "Sustainability score" placeholder (for Epic 6)

---

## Tasks / Subtasks

- [ ] **Task 1: Create Analytics Dashboard Screen** (AC: 1)
  - [ ] Expand existing `analytics.tsx` screen with dashboard sections
  - [ ] Add navigation from Profile tab
  - [ ] Create scrollable layout with section cards

- [ ] **Task 2: Build Summary Stats Cards** (AC: 2)
  - [ ] Calculate total wardrobe items count
  - [ ] Calculate total wardrobe value (sum of purchase_price)
  - [ ] Calculate average CPW across all items
  - [ ] Display in row of stat cards

- [ ] **Task 3: Create Category Distribution Chart** (AC: 3)
  - [ ] Group items by category
  - [ ] Create pie/donut chart visualization
  - [ ] Use category colors for segments
  - [ ] Show percentage labels

- [ ] **Task 4: Create Wear Frequency Chart** (AC: 4)
  - [ ] Query wear_logs for last 30 days
  - [ ] Aggregate by day
  - [ ] Create bar/line chart visualization
  - [ ] Show daily wear count

- [ ] **Task 5: Add AI-Generated Insights** (AC: 5)
  - [ ] Analyze wardrobe data for patterns
  - [ ] Generate 2-3 actionable insights
  - [ ] Examples: "You wear Tops most!", "Consider more Bottoms"
  - [ ] Display in insight cards

- [ ] **Task 6: Add Neglected Items Card** (AC: 6)
  - [ ] Show count of neglected items
  - [ ] Add "View" button linking to wardrobe filter
  - [ ] Reuse neglected calculation from Story 5.4

- [ ] **Task 7: Add Sustainability Score Placeholder** (AC: 7)
  - [ ] Create grayed-out sustainability card
  - [ ] Show "Coming in Epic 6" message
  - [ ] Placeholder score visualization

- [ ] **Task 8: Testing**
  - [ ] Test stat calculations accuracy
  - [ ] Test chart rendering
  - [ ] Test navigation to filtered views
  - [ ] Test empty states

---

## Dev Notes

### Previous Story Dependencies
- Story 5.1: wear_logs table âœ…
- Story 5.3: CPW calculation âœ…
- Story 5.4: Neglected items logic âœ…
- Story 5.5: Analytics screen exists âœ…

### Analytics Calculations

```typescript
interface WardrobeStats {
    totalItems: number;
    totalValue: number;
    averageCPW: number;
    categoryBreakdown: { category: string; count: number; percentage: number }[];
    wearFrequency: { date: string; count: number }[];
    neglectedCount: number;
}

async function getWardrobeStats(): Promise<WardrobeStats> {
    // Total items
    const { count: totalItems } = await supabase
        .from('items')
        .select('*', { count: 'exact', head: true });
    
    // Total value
    const { data: items } = await supabase
        .from('items')
        .select('purchase_price, wear_count, category');
    
    const totalValue = items?.reduce((sum, item) => 
        sum + (item.purchase_price || 0), 0) || 0;
    
    // Average CPW
    const itemsWithCPW = items?.filter(i => i.purchase_price && i.wear_count > 0);
    const avgCPW = itemsWithCPW?.length 
        ? itemsWithCPW.reduce((sum, i) => sum + (i.purchase_price! / i.wear_count), 0) / itemsWithCPW.length
        : 0;
    
    // Category breakdown
    const categoryBreakdown = // group and count by category
    
    // Wear frequency (last 30 days)
    const wearFrequency = // query wear_logs grouped by date
    
    return { totalItems, totalValue, averageCPW, categoryBreakdown, wearFrequency, neglectedCount };
}
```

### Chart Library Options

For React Native charts, consider:
- `react-native-svg` + custom paths (lightweight)
- `victory-native` (full-featured)
- `react-native-chart-kit` (simple setup)

Recommendation: Start with simple SVG-based visualization for MVP.

### UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Wardrobe Analytics               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ 45  â”‚ â”‚$2.4Kâ”‚ â”‚$12  â”‚            â”‚
â”‚ â”‚Itemsâ”‚ â”‚Valueâ”‚ â”‚ CPW â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Category Distribution    [donut]    â”‚
â”‚  ğŸ”µ Tops 35%                        â”‚
â”‚  ğŸŸ¢ Bottoms 25%                     â”‚
â”‚  ğŸŸ¡ Outerwear 15%                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Wear Frequency (30 days) [bar chart]â”‚
â”‚  â–“â–“â–“â–â–“â–“â–“â–“â–“â–â–â–“â–“â–“â–â–“â–“â–“â–“â–“â–“â–...         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ Insights                         â”‚
â”‚ â€¢ You wear Tops most often!         â”‚
â”‚ â€¢ Consider adding more Bottoms      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ 5 Neglected Items    [View â†’]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŒ± Sustainability Score             â”‚
â”‚    Coming in Epic 6...              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Category Colors

| Category | Color | Hex |
|----------|-------|-----|
| Tops | Blue | `#3b82f6` |
| Bottoms | Green | `#22c55e` |
| Dresses | Pink | `#ec4899` |
| Outerwear | Orange | `#f97316` |
| Shoes | Purple | `#8b5cf6` |
| Accessories | Teal | `#14b8a6` |

### AI Insights Examples

- "You wear **Tops** 40% of the time â€” your most used category!"
- "Your **Black Jeans** have the best CPW at $2.50/wear ğŸ†"
- "Consider diversifying â€” you only have 2 **Dresses**"
- "5 items haven't been worn in 2+ months"

### File Locations

| File | Path |
|------|------|
| Analytics Screen | `apps/mobile/app/(tabs)/analytics.tsx` |
| Analytics Service | `apps/mobile/services/analyticsService.ts` |
| Chart Components | `apps/mobile/components/charts/` |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-06 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
TypeScript errors in analyticsService.ts (`calculateCPW` returns `number | null`) â€” fixed by adding `|| 0` / `|| Infinity` fallbacks.

### Completion Notes List
- Created `analyticsService.ts` with `getWardrobeStats()` â€” fetches all items, calculates total items/value/avg CPW, category breakdown, 30-day wear frequency, neglected count, and rule-based insights
- Category distribution uses a stacked horizontal bar chart (View-based, no SVG dependency) with color-coded legend matching story spec colors
- Wear frequency uses a 30-day bar chart (View-based) with bars colored by activity level, "Today" highlighted in indigo
- Insights generated rule-based: most-used category, best CPW item, underrepresented category, neglected count â€” rendered with **bold** markdown parsing
- Neglected items card links to wardrobe screen
- Sustainability score placeholder (grayed out, "Coming in Epic 6")
- Expanded existing analytics.tsx: dashboard sections at top, divider, then existing leaderboard (Story 5.5) below
- Added "Wardrobe Analytics" menu item (indigo icon) at top of Profile tab's menu section
- No extra chart library installed â€” all visualizations are pure React Native Views

### File List

| File | Action | Description |
|------|--------|-------------|
| `apps/mobile/services/analyticsService.ts` | Created | getWardrobeStats with stats, category breakdown, wear frequency, insights |
| `apps/mobile/app/(tabs)/analytics.tsx` | Modified | Added dashboard sections (stats, charts, insights, neglected, sustainability) above leaderboard |
| `apps/mobile/app/(tabs)/profile.tsx` | Modified | Added Wardrobe Analytics menu item with navigation |

---

## QA Results
_(To be completed by QA Agent)_
