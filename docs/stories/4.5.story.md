# Story 4.5: Manual Outfit Builder

## Status

**Done**

---

## Story

**As a** user,  
**I want** to create my own outfits by selecting items,  
**so that** I can save combinations I discover myself.

---

## Acceptance Criteria

1. "Create Outfit" button opens builder screen
2. Items organized by category for easy selection
3. Tap item to add to outfit preview
4. Visual preview shows selected items composed together
5. Save outfit with optional name and occasion tag
6. Outfit saved to "My Outfits" collection
7. Can edit existing outfits (add/remove items)

---

## Tasks / Subtasks

- [x] **Task 1: Create OutfitBuilder Screen** (AC: 1)
  - [x] Create `app/(tabs)/outfits/builder.tsx` screen
  - [x] Add header with back button and "Save" button
  - [x] Register as hidden screen in `_layout.tsx` (like swipe screen)
  - [x] Add "Create Outfit" button to outfits.tsx that navigates to builder

- [x] **Task 2: Implement Category Tabs for Item Selection** (AC: 2)
  - [x] Create horizontal scrollable category tabs: All, Tops, Bottoms, Dresses, Outerwear, Shoes, Accessories
  - [x] Filter wardrobe items by selected category
  - [x] Display items in grid layout using `processed_image_url || image_url`

- [x] **Task 3: Implement Item Selection Logic** (AC: 3, 4)
  - [x] Track selected items in component state (max 6 items per outfit)
  - [x] Show visual selection indicator on tapped items (checkmark/border)
  - [x] Create outfit preview component showing selected items composed together
  - [x] Preview updates dynamically as items are added/removed

- [x] **Task 4: Implement Save Outfit Flow** (AC: 5, 6)
  - [x] Add text input for optional outfit name
  - [x] Add occasion tag selector (Chip/Tag component): casual, work, formal, sport, night_out
  - [x] Validate minimum 2 items selected before saving
  - [x] Call `outfitService.createOutfit()` with `is_ai_generated: false`
  - [x] Navigate back to Outfits tab on success with toast notification

- [x] **Task 5: Implement Edit Outfit Mode** (AC: 7)
  - [x] Accept optional `outfitId` route param for edit mode
  - [x] Load existing outfit data when editing
  - [x] Pre-select items from existing outfit
  - [x] Update outfit via `outfitService.updateOutfit()` on save
  - [x] Add "Edit" button to outfit cards in outfits.tsx

- [x] **Task 6: Testing**
  - [x] Test creating outfit with different item combinations
  - [x] Test editing existing outfit
  - [x] Test validation (minimum items, empty state)
  - [x] Test navigation flow and state persistence

---

## Dev Notes

### Previous Story Insights (from Story 4.4)
- Gesture handling uses `react-native-gesture-handler` and `react-native-reanimated`
- Screens in `outfits/` subfolder should be hidden in tab layout with `href: null`
- Use `processed_image_url || image_url` for background-removed images
- `outfitService` and `outfitStore` already exist with save functionality

### Data Models

**Outfit** `[Source: architecture.md#Outfit]`
```typescript
interface Outfit {
  id: string;
  user_id: string;
  name: string | null;
  occasion: Occasion | null;
  is_ai_generated: boolean;  // Set to FALSE for manual outfits
  weather_context: WeatherContext | null;
  created_at: Date;
}
```

**OutfitItem** `[Source: architecture.md#OutfitItem]`
```typescript
interface OutfitItem {
  outfit_id: string;
  item_id: string;
  position: 'top' | 'bottom' | 'shoes' | 'accessory' | 'outerwear';
}
```

**Categories** `[Source: architecture.md#Category]`
```typescript
type Category = 'tops' | 'bottoms' | 'dresses' | 'outerwear' | 'shoes' | 'accessories';
type Occasion = 'casual' | 'work' | 'formal' | 'sport' | 'night_out';
```

### API Specifications

**Create Outfit** `[Source: services/outfitService.ts]`
```typescript
outfitService.createOutfit({
  name: string | null,
  occasion: Occasion | null,
  is_ai_generated: false,
  item_ids: string[]
})
```

**Existing Services:**
- `itemsService.getItems()` - returns all wardrobe items
- `outfitStore.fetchOutfits()` - refreshes saved outfits list

### UI Component Specifications `[Source: front-end-spec.md#Component-Library]`

| Component | Usage |
|-----------|-------|
| **Chip/Tag** | Occasion selector (casual, work, formal, sport, night_out) |
| **Item Thumbnail** | With Selected variant for selection state |
| **Button** | Primary for Save, Ghost for Cancel |
| **Card** | For outfit preview area |

**Design Colors** `[Source: front-end-spec.md#Color-Palette]`
- Primary: `#5D4E37`
- Background: `#F5F0E8`
- Accent: `#7D9A78` (success/save)
- Selection highlight: Use accent color with border

### File Locations `[Source: architecture.md#Project-Structure]`

| File | Path |
|------|------|
| Builder Screen | `apps/mobile/app/(tabs)/outfits/builder.tsx` |
| Tab Layout | `apps/mobile/app/(tabs)/_layout.tsx` |
| Outfits Tab | `apps/mobile/app/(tabs)/outfits.tsx` |
| Outfit Service | `apps/mobile/services/outfitService.ts` |
| Outfit Store | `apps/mobile/stores/outfitStore.ts` |
| Items Service | `apps/mobile/services/items.ts` |

### Testing

**Test Requirements** `[Source: architecture.md#Testing]`
- Jest + React Native Testing Library
- Test file location: alongside components or in `__tests__/`
- Focus on: component renders, selection logic, save validation

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude (Anthropic) via Antigravity

### Debug Log References
TypeScript check passed (only pre-existing error in aiCategorization.ts)

### Completion Notes List
1. Created `builder.tsx` with full outfit builder functionality
2. Category tabs with horizontal scrolling (All, Tops, Bottoms, Dresses, Outerwear, Shoes, Accessories)
3. Item grid with selection state (checkmark overlay, border highlight)
4. Selected items preview with horizontal scroll and remove functionality
5. Occasion tag chips (casual, work, formal, sport, social)
6. Name input field for optional outfit naming
7. Validation for minimum 2 items before save
8. Edit mode via `outfitId` route param
9. Edit button added to outfit cards in outfits.tsx

### File List

| File | Action | Description |
|------|--------|-------------|
| `app/(tabs)/outfits/builder.tsx` | NEW | Manual outfit builder screen |
| `app/(tabs)/_layout.tsx` | MODIFIED | Added hidden screen for builder |
| `app/(tabs)/outfits.tsx` | MODIFIED | Added Create/Edit navigation |

---

## QA Results
_(To be completed by QA Agent)_
