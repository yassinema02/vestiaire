# Story 2.7: Onboarding "First 5 Items" Challenge

## Status

**Done**

---

## Story

**As a** new user,  
**I want** to be guided to upload my first 5 items,  
**so that** I can start using AI features quickly.

---

## Acceptance Criteria

1. After sign-up, onboarding flow prompts to add 5 items
2. Progress indicator: "2/5 items added"
3. Skip option available (with warning about limited functionality)
4. Celebration animation upon completing 5 items
5. AI features unlocked message displayed
6. Onboarding state persisted (not shown again)

---

## Tasks / Subtasks

- [ ] **Task 1: Create onboarding state management** (AC: 6)
  - [ ] Add `onboarding_completed` field to user profiles table (or use AsyncStorage)
  - [ ] Create onboarding service to track completion state
  - [ ] Persist onboarding state so it's not shown again after completion

- [ ] **Task 2: Create onboarding screen** (AC: 1, 2)
  - [ ] Create `app/onboarding.tsx` screen
  - [ ] Design welcome message explaining the "First 5 Items" challenge
  - [ ] Show progress indicator (e.g., "2/5 items added")
  - [ ] Display visual progress bar or step indicators

- [ ] **Task 3: Integrate with add item flow** (AC: 2)
  - [ ] Update item count after each successful upload
  - [ ] Navigate back to onboarding screen to show updated progress
  - [ ] Or show floating progress badge on Add screen during onboarding

- [ ] **Task 4: Implement skip functionality** (AC: 3)
  - [ ] Add "Skip for now" button on onboarding screen
  - [ ] Show warning modal about limited AI functionality
  - [ ] Mark onboarding as skipped (but can be resumed)
  - [ ] Navigate to main wardrobe after skip

- [ ] **Task 5: Implement completion celebration** (AC: 4, 5)
  - [ ] Detect when user reaches 5 items
  - [ ] Show celebration animation (confetti or similar)
  - [ ] Display "AI Features Unlocked!" message
  - [ ] Mark onboarding as completed
  - [ ] Navigate to wardrobe with success state

- [ ] **Task 6: Add onboarding flow trigger** (AC: 1)
  - [ ] Check onboarding state after sign-up/login
  - [ ] If not completed and items < 5, show onboarding
  - [ ] If completed or items >= 5, go directly to main app

---

## Dev Notes

### Previous Story Insights
[Source: Story 2.6]
- Item service at `services/items.ts` provides `getItems()` to count user items
- Wardrobe screen shows empty state when no items exist
- Navigation uses expo-router with file-based routing

### Data Model Additions
```typescript
// Option 1: Add to profiles table via Supabase
interface ProfileOnboarding {
  onboarding_completed: boolean;
  onboarding_skipped_at: Date | null;
  onboarding_completed_at: Date | null;
}

// Option 2: Use AsyncStorage for local persistence
const ONBOARDING_KEY = '@vestiaire_onboarding_complete';
```

### Onboarding State Logic
```typescript
// Check if should show onboarding
const shouldShowOnboarding = async (): Promise<boolean> => {
  const completed = await AsyncStorage.getItem(ONBOARDING_KEY);
  if (completed === 'true') return false;
  
  const { items } = await itemsService.getItems();
  return items.length < 5;
};
```

### File Locations
- New screen: `apps/mobile/app/onboarding.tsx`
- New service: `apps/mobile/services/onboarding.ts`
- Update: `apps/mobile/app/_layout.tsx` (add onboarding check)
- Update: `apps/mobile/app/(tabs)/add.tsx` (update progress after upload)

### UI Components Needed
- Progress bar or step indicator (1-5)
- Celebration animation (use `react-native-reanimated` or Lottie)
- Warning modal for skip confirmation
- Success modal for completion

### Animation Options
[Source: architecture.md#Tech Stack]
- Consider using `react-native-reanimated` for performant animations
- Alternative: Lottie animations for pre-built celebration effects
- Simple option: Scale + opacity animations with built-in Animated API

### Navigation Flow
```
Sign-up/Login → Check Onboarding State
                    ↓
           Items < 5 AND not completed?
                    ↓ Yes               ↓ No
            Onboarding Screen    →    Main App (Tabs)
                    ↓
              Add Items (loop)
                    ↓
           Reached 5 items?
                    ↓ Yes
            Celebration → Main App
```

---

## Testing

### Manual Testing
- Fresh sign-up should trigger onboarding
- Verify progress updates after each item added
- Test skip button shows warning and navigates to app
- Verify celebration appears at exactly 5 items
- Confirm onboarding doesn't show on subsequent logins
- Test that existing users with 5+ items don't see onboarding

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-24 | 1.0 | Initial story draft | Bob (SM) |
