# Story 5.5: Most Worn Items Leaderboard

## Status

**Implemented**

---

## Story

**As a** user,  
**I want** to see my most-worn items,  
**so that** I know which clothes I truly love.

---

## Acceptance Criteria

1. "Top Worn" section in Analytics dashboard
2. Top 10 items ranked by wear count
3. Visual: podium or ranked list with wear counts
4. Breakdown by category available
5. Time filter: all time, this month, this season
6. Insight: "Your black jeans are your wardrobe MVP! üèÜ"

---

## Tasks / Subtasks

- [ ] **Task 1: Create Most Worn Query Service** (AC: 2)
  - [ ] Add `getMostWornItems(limit, categoryFilter?, dateFilter?)` to wearLogService
  - [ ] Query items ordered by wear_count DESC
  - [ ] Support category filtering
  - [ ] Support date range filtering (all time, this month, this season)

- [ ] **Task 2: Create Analytics Screen/Section** (AC: 1)
  - [ ] Create `app/(tabs)/analytics.tsx` screen
  - [ ] Or add Analytics section to Profile tab
  - [ ] Add navigation to analytics from Home/Profile

- [ ] **Task 3: Build Top Worn Leaderboard UI** (AC: 2, 3)
  - [ ] Create podium visualization (1st, 2nd, 3rd place)
  - [ ] Ranked list for positions 4-10
  - [ ] Display item image, name, and wear count
  - [ ] Gold/Silver/Bronze styling for top 3

- [ ] **Task 4: Implement Category Filter** (AC: 4)
  - [ ] Add category filter chips (All, Tops, Bottoms, etc.)
  - [ ] Filter leaderboard by selected category
  - [ ] Show "No items" state if category is empty

- [ ] **Task 5: Implement Time Filter** (AC: 5)
  - [ ] Add time filter: All Time, This Month, This Season
  - [ ] Calculate season based on current date
  - [ ] Filter wear_logs by date range before counting

- [ ] **Task 6: Add MVP Insight** (AC: 6)
  - [ ] Display insight text for #1 item
  - [ ] "Your {item_name} is your wardrobe MVP! üèÜ"
  - [ ] Show wear count context: "Worn X times"

- [ ] **Task 7: Testing**
  - [ ] Test leaderboard ranking accuracy
  - [ ] Test category filter
  - [ ] Test time filter ranges
  - [ ] Test empty state displays

---

## Dev Notes

### Previous Story Dependencies
- Story 5.1: wear_logs table with wear_count on items ‚úÖ
- Story 5.3: CPW displayed on items ‚úÖ
- Story 5.4: Neglected items filter ‚úÖ

### Most Worn Query

```typescript
interface MostWornFilter {
    category?: string;
    dateRange?: 'all_time' | 'this_month' | 'this_season';
    limit?: number;
}

async function getMostWornItems(filter: MostWornFilter): Promise<WardrobeItem[]> {
    let query = supabase
        .from('items')
        .select('*')
        .order('wear_count', { ascending: false })
        .limit(filter.limit || 10);
    
    if (filter.category && filter.category !== 'All') {
        query = query.eq('category', filter.category);
    }
    
    // For date filtering, we need to query wear_logs
    // and aggregate by item_id within the date range
    
    return query;
}
```

### Season Calculation

```typescript
function getCurrentSeason(): { start: Date; end: Date; name: string } {
    const now = new Date();
    const month = now.getMonth();
    
    if (month >= 2 && month <= 4) {
        return { name: 'Spring', start: new Date(now.getFullYear(), 2, 1), end: new Date(now.getFullYear(), 4, 30) };
    } else if (month >= 5 && month <= 7) {
        return { name: 'Summer', start: new Date(now.getFullYear(), 5, 1), end: new Date(now.getFullYear(), 7, 31) };
    } else if (month >= 8 && month <= 10) {
        return { name: 'Fall', start: new Date(now.getFullYear(), 8, 1), end: new Date(now.getFullYear(), 10, 30) };
    } else {
        return { name: 'Winter', start: new Date(now.getFullYear(), 11, 1), end: new Date(now.getFullYear() + 1, 1, 28) };
    }
}
```

### UI Components

**Podium Visualization:**
```
        ü•á
       ‚îå‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ 1 ‚îÇ
    ‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îê
 ü•à‚îÇ    2    ‚îÇü•â
 ‚îå‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îê
 ‚îÇ      3      ‚îÇ
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Leaderboard List (4-10):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4  [img] Navy Blazer         12 wears ‚îÇ
‚îÇ 5  [img] White Sneakers       9 wears ‚îÇ
‚îÇ 6  [img] Grey Hoodie          8 wears ‚îÇ
‚îÇ ...                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Color Palette

| Position | Color | Hex |
|----------|-------|-----|
| 1st (Gold) | Gold | `#fbbf24` |
| 2nd (Silver) | Silver | `#9ca3af` |
| 3rd (Bronze) | Bronze | `#d97706` |

### File Locations

| File | Path |
|------|------|
| Analytics Screen | `apps/mobile/app/(tabs)/analytics.tsx` |
| Wear Log Service | `apps/mobile/services/wearLogService.ts` |
| Leaderboard Component | `apps/mobile/components/features/MostWornLeaderboard.tsx` |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-06 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
No issues ‚Äî clean TypeScript compile (only pre-existing aiCategorization.ts error).

### Completion Notes List
- Added `getMostWornItems` method to wearLogService with DateRangeFilter, MostWornItem types, season calculation helpers
- For all-time queries, uses items.wear_count directly; for date-filtered queries, aggregates wear_logs within range
- Created analytics screen with podium visualization (gold/silver/bronze top 3), ranked list (4-10), MVP insight card
- Time filters: All Time, This Month, This Season (meteorological seasons)
- Category filter chips: All, Tops, Bottoms, Dresses, Outerwear, Shoes, Accessories
- Tapping any item navigates to item-detail screen
- Added analytics navigation card on Home screen (indigo themed)
- Registered analytics route in _layout.tsx with `href: null`
- No separate MostWornLeaderboard component created ‚Äî all logic is in analytics.tsx for simplicity

### File List

| File | Action | Description |
|------|--------|-------------|
| `apps/mobile/services/wearLogService.ts` | Modified | Added getMostWornItems, DateRangeFilter, MostWornItem, season helpers |
| `apps/mobile/app/(tabs)/analytics.tsx` | Created | Full leaderboard screen with podium, ranked list, filters, MVP insight |
| `apps/mobile/app/(tabs)/_layout.tsx` | Modified | Registered analytics route with href: null |
| `apps/mobile/app/(tabs)/index.tsx` | Modified | Added analytics navigation card on Home screen |

---

## QA Results
_(To be completed by QA Agent)_
