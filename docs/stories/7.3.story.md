# Story 7.3: Listing Copy & Share

## Status

**Done**

---

## Story

**As a** user,  
**I want** to copy my listing and share it to Vinted,  
**so that** I can post my item for sale easily.

---

## Acceptance Criteria

1. "Copy to Clipboard" button copies full listing text
2. "Share to Vinted" button (opens Vinted app if installed, or App Store/web)
3. Share sheet integration for general sharing
4. Save background-removed image to Camera Roll
5. Success toast/confirmation: "Copied! Ready to paste in Vinted"
6. Tutorial overlay/tooltip on first use ("Paste this description in Vinted")

---

## Tasks / Subtasks

- [ ] **Task 1: Clipboard Integration** (AC: 1, 5)
  - [ ] Implement `copyToClipboard` function using `expo-clipboard`
  - [ ] Format text with proper spacing for Vinted
  - [ ] Show success toast/snackbar on copy

- [ ] **Task 2: Vinted Deep Link / Share** (AC: 2, 3)
  - [ ] Check if Vinted app is installed (using `Linking.canOpenURL`)
  - [ ] Implement "Open Vinted" button
  - [ ] Implement generic "Share" button using `Share.share()`
  - [ ] Fallback to Vinted web URL if app not installed

- [ ] **Task 3: Photo Export** (AC: 4)
  - [ ] Add "Save Image" button to listing preview
  - [ ] Request media library permissions
  - [ ] Save processed (background-removed) image to Camera Roll using `expo-media-library`
  - [ ] Handle permission denial gracefully

- [ ] **Task 4: UI Enhancements** (AC: 6)
  - [ ] Add action buttons to `ListingGeneratorModal`
  - [ ] Add "How to list" tooltip or mini-tutorial
  - [ ] Style buttons (Primary: Copy, Secondary: Share/Save)

- [ ] **Task 5: Testing**
  - [ ] Test clipboard copy
  - [ ] Test Vinted deep linking
  - [ ] Test image saving (requires real device/sim with photos)
  - [ ] Test share sheet

---

## Dev Notes

### Dependencies
- `expo-clipboard`
- `expo-linking`
- `expo-sharing`
- `expo-media-library`
- `expo-file-system` (maybe needed for image saving)

### Vinted Deep Link
Vinted URL scheme: `vinted://` (needs verification). Fallback: `https://www.vinted.co.uk/add-item` (or user's locale).

### Listing Format
```text
[Title]

[Description]

Category: [Category]
Condition: [Condition]
Brand: [Brand]
Size: [Size]
```

### File Locations

| File | Path |
|------|------|
| Listing Generator Modal | `apps/mobile/components/features/ListingGeneratorModal.tsx` |
| Resale Service | `apps/mobile/services/resaleService.ts` |
| Listing Service | `apps/mobile/services/listingService.ts` |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-08 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
- TS check: 0 new errors (pre-existing in `_layout.tsx`, `SwipeableOutfitCard.tsx`, `aiCategorization.ts` remain)

### Completion Notes List
1. Replaced deprecated RN `Clipboard` with `expo-clipboard` (`setStringAsync`)
2. Added `formatListingText()` helper — formats clipboard text with title, description, category, brand, condition, and hashtags per Vinted format spec
3. Added Share sheet integration using RN `Share.share()` API
4. Added "Save Photo" button — downloads processed (background-removed) image via `expo-file-system/legacy` and saves to Camera Roll via `expo-media-library`, with permission handling
5. Added first-use tutorial tooltip (amber card with animated fade-in, "Got it" dismiss, persisted via AsyncStorage)
6. "Copy & Open Vinted" button now auto-copies listing before opening Vinted (deep link or .co.uk web fallback)
7. Added inline success toast: "Copied! Ready to paste in Vinted"
8. Action buttons reorganized: Primary row (Copy All + Copy & Open Vinted), Secondary row (Share + Save Photo)

### File List

| File | Action | Description |
|------|--------|-------------|
| `apps/mobile/components/features/ListingGeneratorModal.tsx` | Modified | Added clipboard (expo-clipboard), share sheet, image save, tooltip, formatted text, success toast |
| `apps/mobile/package.json` | Modified | Added `expo-clipboard` dependency |

---

## QA Results
_(To be completed by QA Agent)_
