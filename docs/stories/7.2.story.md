# Story 7.2: AI Listing Generator

## Status

**Done**

---

## Story

**As a** user,
**I want** the app to generate a resale listing description,
**so that** I can quickly list items on Vinted without writing.

---

## Acceptance Criteria

1. "Generate Listing" action on item detail screen
2. AI generates: title, description, suggested category, condition guess
3. Uses item metadata: brand, color, category, photos
4. Description optimized for Vinted format and SEO
5. Multiple description style options: casual, detailed, minimal
6. User can edit generated text before copying
7. Generation takes <5 seconds

---

## Tasks / Subtasks

- [ ] **Task 1: Generate Listing Edge Function** (AC: 2, 3, 4, 5)
  - [ ] Create `supabase/functions/generate-listing/index.ts`.
  - [ ] Implement Interface:
    ```typescript
    interface GenerateListingRequest {
      item_name: string;
      brand: string;
      category: string;
      features: string[]; // e.g., "Cotton", "Blue"
      tone: 'casual' | 'detailed' | 'minimal';
    }
    interface GenerateListingResponse {
      title: string;
      description: string;
      suggested_price_range: string;
      hashtags: string[];
    }
    ```
  - [ ] Prompt Engineering:
    - Instruct GPT-4o-mini to act as an expert reseller.
    - Output strict JSON.
    - Include SEO keywords relevant to the brand/item.

- [ ] **Task 2: Service Layer Integration** (AC: 1, 7)
  - [ ] Update `resaleService.ts` (created in 7.1).
  - [ ] Add `generateListing(itemId: string, tone: Tone): Promise<ListingData>`.
  - [ ] Fetch item details from DB first, then call Edge Function.

- [ ] **Task 3: UI - Listing Generator Modal** (AC: 1, 6)
  - [ ] Create `ListingGeneratorModal`.
  - [ ] Trigger from Item Detail > "Resale" > "Generate Description".
  - [ ] Inputs: Tone selector (Segmented Control).
  - [ ] Loading State: Skeleton text or "Thinking..." animation.
  - [ ] Result View:
    - Editable Text Input for Title & Description.
    - "Copy to Clipboard" button.
    - "Open Vinted" (Deep link `vinted://` if possible, else web link).

- [ ] **Task 4: Testing**
  - [ ] Unit Test `generate-listing` function (mock OpenAI response).
  - [ ] Manual Test: Select item -> Generate -> Check quality of text -> Copy.

---

## Dev Notes

### Architecture references
- **Edge Function**: New `generate-listing` function.
- **Service**: Extends `resaleService`.

### Technical Decisions
- **Tone**: Passed as parameter to allow user control.
- **Deep Link**: We'll try to open Vinted app if installed, but copying text is the primary MVP feature since Vinted API isn't public for posting.

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-07 | 1.0 | Initial story draft | Bob (SM) |
