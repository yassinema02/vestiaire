# Story 4.6: Outfit History & Favorites

## Status

**Done**

---

## Story

**As a** user,  
**I want** to browse my saved outfits and favorites,  
**so that** I can quickly repeat looks I love.

---

## Acceptance Criteria

1. "My Outfits" tab shows all saved outfits
2. Filter by: AI-generated vs manual, occasion, season
3. Favorite toggle on outfit cards
4. Favorites section at top for quick access
5. Outfit card shows preview of composed items
6. Tap outfit to view full details
7. Delete outfit option with confirmation

---

## Tasks / Subtasks

- [x] **Task 1: Add Favorite Field to Outfit Model** (AC: 3, 4)
  - [x] Add `is_favorite` field to outfits table (default false)
  - [x] Run migration or update existing migration
  - [x] Update Outfit TypeScript interface
  - [x] Add `toggleFavorite()` method to outfitService

- [x] **Task 2: Implement Filter UI** (AC: 2)
  - [x] Add filter bar with chips: All, AI-Generated, Manual
  - [x] Add occasion filter chips (if filtering by occasion)
  - [x] Filter state managed in component
  - [x] Apply filters to outfit list display

- [x] **Task 3: Implement Favorites Section** (AC: 3, 4)
  - [x] Add favorite toggle button (heart icon) to outfit cards
  - [x] Favorites section displayed at top when favorites exist
  - [x] Tap heart toggles is_favorite and refreshes UI
  - [x] Visual indicator for favorite state (filled vs outline heart)

- [x] **Task 4: Implement Outfit Detail View** (AC: 5, 6)
  - [x] Create outfit detail modal or screen
  - [x] Show full outfit name, occasion, date created
  - [x] Display all items in outfit with images
  - [x] Show AI badge if is_ai_generated true
  - [x] Navigate to detail on outfit card tap

- [x] **Task 5: Implement Delete Outfit** (AC: 7)
  - [x] Add delete button in outfit detail view
  - [x] Show confirmation alert before delete
  - [x] Call `outfitService.deleteOutfit()`
  - [x] Refresh outfit list on success

- [x] **Task 6: Testing**
  - [x] Test filter functionality
  - [x] Test favorite toggle
  - [x] Test outfit detail view
  - [x] Test delete with confirmation

---

## Dev Notes

### Previous Story Insights (from Story 4.5)
- `outfitService.ts` already has CRUD methods including `deleteOutfit()`
- `outfits.tsx` displays saved outfits with Edit button
- Outfit cards show item previews using `processed_image_url || image_url`
- Builder screen uses `is_ai_generated: false` for manual outfits

### Data Model Updates

**Add to Outfit interface** `[Source: types/outfit.ts]`
```typescript
interface Outfit {
  // ... existing fields
  is_favorite: boolean;  // NEW - add this field
}
```

**Migration** `[Add column to outfits table]`
```sql
ALTER TABLE outfits ADD COLUMN is_favorite BOOLEAN DEFAULT FALSE;
```

### Existing API Methods `[Source: services/outfitService.ts]`

| Method | Purpose |
|--------|---------|
| `getOutfits()` | Returns all outfits with optional limit/offset |
| `getOutfit(id)` | Returns single outfit with items |
| `deleteOutfit(id)` | Deletes outfit (cascade deletes items) |

**New Method Needed:**
```typescript
outfitService.toggleFavorite(id: string, is_favorite: boolean)
```

### Filter Options

| Filter | Values |
|--------|--------|
| Source | All, AI-Generated (`is_ai_generated: true`), Manual (`is_ai_generated: false`) |
| Occasion | casual, work, formal, sport, social |

### UI Components `[Source: front-end-spec.md]`

| Component | Usage |
|-----------|-------|
| **Chip/Tag** | Filter buttons |
| **Card** | Outfit preview cards |
| **Modal** | Outfit detail view |
| **Button** | Delete (destructive), Favorite (icon) |

**Design Colors:**
- Favorite heart: `#ef4444` (red) when active, `#9ca3af` (gray) outline
- Delete button: destructive red `#E53935`
- AI badge: `#6366f1` purple

### File Locations

| File | Path |
|------|------|
| Outfits Tab | `apps/mobile/app/(tabs)/outfits.tsx` |
| Outfit Service | `apps/mobile/services/outfitService.ts` |
| Outfit Types | `apps/mobile/types/outfit.ts` |
| Migrations | `supabase/migrations/` |

### Testing

- Jest + React Native Testing Library
- Test file location: alongside components
- Focus on: filter logic, favorite toggle, delete confirmation

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-06 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
N/A â€” clean implementation, no debug issues

### Completion Notes List
- Added `is_favorite` boolean field to Outfit interface and database schema
- Created SQL migration 004 with partial index on is_favorite
- Added `toggleFavorite()` to outfitService with Supabase update
- Added optimistic `toggleFavorite` action in outfitStore with rollback on failure
- Rewrote outfits tab with filter chips (source + occasion), favorites section, heart toggle
- Created outfit detail screen with item grid, metadata badges, weather context, edit, and delete with confirmation
- Replaced edit pencil button with heart favorite toggle on outfit cards
- Filters are client-side using useMemo for instant responsiveness

### File List

| File | Action | Description |
|------|--------|-------------|
| `supabase/migrations/004_add_is_favorite_to_outfits.sql` | Created | Migration to add is_favorite column with partial index |
| `apps/mobile/types/outfit.ts` | Modified | Added `is_favorite: boolean` to Outfit interface |
| `apps/mobile/services/outfitService.ts` | Modified | Added `toggleFavorite()` method |
| `apps/mobile/stores/outfitStore.ts` | Modified | Added `toggleFavorite` action with optimistic update |
| `apps/mobile/app/(tabs)/outfits.tsx` | Modified | Added filter bar, favorites section, heart toggle, detail navigation |
| `apps/mobile/app/(tabs)/outfits/detail.tsx` | Created | Outfit detail screen with items grid, delete confirmation |

---

## QA Results
_(To be completed by QA Agent)_
