# Story 6.4: Badges & Achievements

## Status

**Implemented**

---

## Story

**As a** user,
**I want** to earn badges for achievements,
**so that** I have collectible goals to work toward.

---

## Acceptance Criteria

1. Badge categories: Upload, Engagement, Sustainability, Secret
2. At least 12 badges implemented for MVP
3. Badges displayed in grid on Profile screen
4. Locked badges shown as silhouettes with hints
5. Badge unlock triggers celebration animation
6. Push notification for significant badge unlocks
7. Badge showcase: user can select 1-3 featured badges

---

## Badge Definitions (from PRD)

| Badge | Category | Requirement | Technical Trigger |
|-------|----------|-------------|-------------------|
| First Step | Upload | Upload first item | `item_count >= 1` |
| Closet Complete | Upload | Upload 50 items | `item_count >= 50` |
| Style Guru | Upload | Upload 100 items | `item_count >= 100` |
| Week Warrior | Engagement | 7-day streak | `streak >= 7` |
| Streak Legend | Engagement | 30-day streak | `streak >= 30` |
| Early Bird | Engagement | Log outfit before 8 AM | `wear_log hour < 8` |
| Rewear Champion | Sustainability | Wear same item 10+ times | `item.wear_count >= 10` |
| Circular Seller | Sustainability | Create first resale listing | `listing_count >= 1` |
| Monochrome Master | Secret | Create all-black outfit | `outfit.items.every(i => i.color == 'Black')` |
| Rainbow Warrior | Secret | Own items in 7+ colors | `distinct(items.color).count >= 7` |
| OG Member | Secret | User since launch month | `created_at` check |
| Weather Warrior | Secret | Log outfit in rain/snow | `wear_log.weather == 'Rain'` |

---

## Tasks / Subtasks

- [ ] **Task 1: Badge Constants & Seeding** (AC: 1, 2)
  - [ ] Create `vestiaire/packages/shared/src/constants/badges.ts`
  - [ ] Define `BADGES` array with all 12 definitions (ID, Name, Description, Category, IconName, Hint)
  - [ ] Create migration `010_seed_badges.sql` to insert these into `badges` table (or handle via code if preferred, but migration is safer for foreign keys)

- [ ] **Task 2: Badge Logic Implementation** (AC: 2)
  - [ ] Update `vestiaire/apps/mobile/services/gamificationService.ts`
  - [ ] Add `checkBadges(userId: string, triggerEvent: 'upload' | 'streak' | 'wear_log'): Promise<Badge[]>`
  - [ ] Implement checks for each badge type depending on trigger:
    - **Upload**: Check item count, Check Color count (Rainbow)
    - **Streak**: Check current streak
    - **Wear Log**: Check time (Early Bird), Weather, Item wear count, Outfit colors (Monochrome)
  - [ ] If condition met AND user doesn't have badge:
    - Insert into `user_badges`
    - Return newly earned badges

- [ ] **Task 3: Integration Points**
  - [ ] Call `checkBadges` in `uploadItem`, `updateStreak`, `logWear`
  - [ ] Handle returned badges -> Trigger Celebration

- [ ] **Task 4: Profile Screen - Badge Grid** (AC: 3, 4)
  - [ ] Create `BadgeGrid` component
  - [ ] Fetch all badges and user's earned badges
  - [ ] Render Grid:
    - Earned: Full color icon + Name
    - Locked: Grayed out/Silhouette + Hint (e.g., "??? - Upload more items")
  - [ ] Section headers by Category? Or simple mixed grid. (PRD says Grid, imply simple)

- [ ] **Task 5: Badge Showcase** (AC: 7)
  - [ ] Add `featured_badges` array to `profiles` table? Or `is_featured` in `user_badges`?
  - [ ] *Decision*: Add `is_featured` boolean to `user_badges` table. (Max 3 true per user)
  - [ ] UI: "Edit Showcase" mode in Profile -> Select up to 3 -> Display prominently at top of Profile.

- [ ] **Task 6: Notifications & Celebration** (AC: 5, 6)
  - [ ] Reuse `LevelUpModal` as generic `CelebrationModal`
  - [ ] Show "Badge Unlocked: [Name]" with Icon
  - [ ] Send Local Push Notification: "You earned the [Name] badge! ðŸ†"

- [ ] **Task 7: Testing**
  - [ ] Unit Test `checkBadges` logic for complex triggers (Monochrome, Rainbow)
  - [ ] Manual Test: "Hack" DB state to meet criteria -> Trigger action -> Verify Badge

---

## Dev Notes

### Architecture references
- **Badges Model**: Defined in `docs/architecture.md`.
- **Gamification Service**: Central logic hub.

### Technical Decisions
- **Seeding**: Badges are static metadata. We will define them in code (`constants`) AND sync to DB `badges` table so specific user-badge relationships work with Foreign Keys.
- **Trigger Logic**: Reactive checks (checking after an action) is simpler than background jobs.
- **Icon Set**: Use Lucide-React-Native icons mapped to Badge IDs.

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-07 | 1.0 | Initial story draft | Bob (SM) |
